<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!-- Include Google Maps JS API -->
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBRlrTYjkjBrpZ7ScRFtStne0aOOeoddVc&libraries=drawing,places"></script>

    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; }
      #mapDiv { width: 100%; height: 100%; }
    </style>
  </head>
  <body>
    <b>My First Map </b>
    <div id="mapDiv"></div>

    <!-- Map creation is here -->
    <script type="text/javascript">
      //Defining map as a global variable to access from
      //other functions
      var map;
      function initMap() {
        // New Place
        var circles;
        var markers;
        var popup;

        circles = new Array();
        markers = new Array();
        popup = new google.maps.InfoWindow();

        var drawingManager = new google.maps.drawing.DrawingManager();

        function resultsCallback(results, status) {
          if (status == google.maps.places.PlacesServiceStatus.OK) {
            for (var i = 0, l=results.length; i < l; i++) {
              pinpointResult(results[i]);
            }
          }
        }

        function pinpointResult(result) {
          var marker = new google.maps.Marker({
            map: map,
            position: result.geometry.location
          });

          google.maps.event.addListener(marker, 'click', function() {
            var popupContent = '<b>Name: </b> ' + result.name +
              '<br/>' + '<b>Vicinity: </b>' + result.vicinity +
              '<br/><b>Rating: </b>' + result.rating;
            popup.setContent(popupContent);
            popup.open(map, this);
          });

          markers.push(marker);
        }

        google.maps.event.addListener(drawingManager, 'circlecomplete', function(circle){
          drawingManager.setDrawingMode(null);
          circles.push(circle);
          circles.reverse();

          while(circles[1]){
            circles.pop().setMap(null);
          }

          while(markers[0]){
            markers.pop().setMap(null);
          }


          var nearbyPlacesRequest = {
            location: circle.getCenter(),
            radius: circle.radius,
            types: [
              'hospital',
              'school',
              'park',
              'supermarket'
            ]
          };

          var placesService = new google.maps.places.PlacesService(map);
          placesService.nearbySearch(nearbyPlacesRequest, resultsCallback);

        });







        //Enabling new cartography and themes
        google.maps.visualRefresh = true;
        //Setting starting options of map
        var mapOptions = {
          center: new google.maps.LatLng(10.801241, 106.712710),
          zoom: 17,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        //Getting map DOM element
        var mapElement = document.getElementById('mapDiv');
        //Creating a map with DOM element which is just
        //obtained
        map = new google.maps.Map(mapElement, mapOptions);
      }
      google.maps.event.addDomListener(window, 'load', initMap);
    </script>
  </body>
</html>
